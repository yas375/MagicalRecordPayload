<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>MagicalRecord 1.8.3 Reference</title>
		<link rel="stylesheet" type="text/css" href="css/styles.css" media="all" />
		<link rel="stylesheet" type="text/css" media="print" href="css/stylesPrint.css" />
		<meta name="generator" content="appledoc 2.0.5 (build 789)" />
	</head>
	<body>
		<header id="top_header">
			<div id="library" class="hideInXcode">
				<h1><a id="libraryTitle" href="index.html">MagicalRecord 1.8.3 </a></h1>
				<a id="developerHome" href="index.html">Saul Mora</a>
			</div>
			
			<div id="title" role="banner">
				<h1 class="hideInXcode">MagicalRecord 1.8.3 Reference</h1>
			</div>
			<ul id="headerButtons" role="toolbar"></ul>
		</header>
		<article>
			<div id="overview_contents" role="main">
				<div class="main-navigation navigation-top">
					<a href="hierarchy.html">Next</a>
				</div>
				<div id="header">
					<div class="section-header">
						<h1 class="title title-header">MagicalRecord 1.8.3 Reference</h1>
					</div>		
				</div>
				<div id="container">
					
					<div class="section section-overview index-overview">
						
						
						<h1>MagicalRecord for Core Data</h1>

<p>In software engineering, the active record pattern is a design pattern found in software that stores its data in relational databases. It was named by Martin Fowler in his book Patterns of Enterprise Application Architecture. The interface to such an object would include functions such as Insert, Update, and Delete, plus properties that correspond more-or-less directly to the columns in the underlying database table.</p>

<blockquote><p>  Active record is an approach to accessing data in a database. A database table or view is wrapped into a class; thus an object  instance is tied to a single row in the table. After creation of an object, a new row is added to the table upon save. Any object   loaded gets its information from the database; when an object is updated, the corresponding row in the table is also updated. The   wrapper class implements accessor methods or properties for each column in the table or view.</p>

<p>  <em>&ndash; <a href="" title="http://en.wikipedia.org/wiki/Active_record_pattern">Wikipedia</a></em></p></blockquote>

<p>Magical Record for Core Data was inspired by the ease of Ruby on Rails' Active Record fetching. The goals of this code are:</p>

<ul>
<li>Clean up my Core Data related code</li>
<li>Allow for clear, simple, one-line fetches</li>
<li>Still allow the modification of the NSFetchRequest when request optimizations are needed</li>
</ul>


<h1>Installation</h1>

<ol>
<li>In your XCode Project, add all the .h and .m files from the <em>Source</em> folder into your project.</li>
<li>Add <em>CoreData+MagicalRecord.h</em> file to your PCH file or your AppDelegate file.</li>
<li>Start writing code! &hellip; There is no step 3!</li>
</ol>


<h1>ARC Support</h1>

<p>MagicalRecord fully supports ARC <em>and</em> non-ARC modes out of the box, there is no configuration necessary. This is great for legacy applications or projects that still need to compile with GCC.  ARC support has been tested with the Apple LLVM 3.0 compiler.</p>

<h1>Usage</h1>

<h2>Setting up the Core Data Stack</h2>

<p>To get started, first, import the header file <em>CoreData+MagicalRecord.h</em> in your project&rsquo;s pch file. This will allow a global include of all the required headers.
Next, somewhere in your app delegate, in either the applicationDidFinishLaunching:(UIApplication <em>) withOptions:(NSDictionary </em>) method, or awakeFromNib, use <strong>one</strong> of the following setup calls with the <a href="Classes/MagicalRecordHelpers.html">MagicalRecordHelpers</a> class:</p>

<pre><code>+ (void) setupCoreDataStack;
+ (void) setupAutoMigratingDefaultCoreDataStack;
+ (void) setupCoreDataStackWithInMemoryStore;
+ (void) setupCoreDataStackWithStoreNamed:(NSString *)storeName;
+ (void) setupCoreDataStackWithAutoMigratingSqliteStoreNamed:(NSString *)storeName;
</code></pre>

<p>Each call instantiates one of each piece of the Core Data stack, and provides getter and setter methods for these instances. These well known instances to MagicalRecord, and are recognized as &ldquo;defaults&rdquo;.</p>

<p>And, before your app exits, you can use the clean up method:</p>

<pre><code>[MagicalRecordHelpers cleanUp];
</code></pre>

<h3>Default Managed Object Context</h3>

<p>When using Core Data, you will deal with two types of objects the most: <em>NSManagedObject</em> and <em>NSManagedObjectContext</em>. MagicalRecord gives you a place for a default NSManagedObjectContext for use within your app. This is great for single threaded apps. You can easily get to this default context by calling:</p>

<pre><code>[NSManagedObjectContext MR_defaultContext];
</code></pre>

<p>This context will be used if a find or request method (described below) is not specifying a specific context using the <strong>inContext:</strong> method overload.</p>

<p>If you need to create a new Managed Object Context for use in other threads, based on the default persistent store that was creating using one of the setup methods, use:</p>

<pre><code>NSManagedObjectContext *myNewContext = [NSManagedObjectContext context];
</code></pre>

<p>This will use the same object model and persistent store, but create an entirely new context for use with threads other than the main thread.</p>

<p>And, if you want to make <em>myNewContext</em> the default for all fetch requests on the main thread:</p>

<pre><code>[NSManagedObjectContext setDefaultContext:myNewContext];
</code></pre>

<p>Magical Record also has a helper method to hold on to a Managed Object Context in a thread&rsquo;s threadDictionary. This lets you access the correct NSManagedObjectContext instance no matter which thread you&rsquo;re calling from. This methods is:</p>

<pre><code>[NSManagedObjectContext MR_contextForCurrentThread];
</code></pre>

<p><strong>It is <em>highly</em> recommended that the default context is created and set using the main thread</strong></p>

<h3>Fetching</h3>

<h4>Basic Finding</h4>

<p>Most methods in MagicalRecord return an NSArray of results. So, if you have an Entity called Person, related to a Department (as seen in various Apple Core Data documentation), to get all the Person entities from your Persistent Store:</p>

<pre><code>NSArray *people = [Person findAll];
</code></pre>

<p>Or, to have the results sorted by a property:</p>

<pre><code>NSArray *peopleSorted = [Person findAllSortedByProperty:@"LastName" ascending:YES];
</code></pre>

<p>Or, to have the results sorted by multiple properties:</p>

<pre><code>NSArray *peopleSorted = [Person findAllSortedByProperty:@"LastName,FirstName" ascending:YES];
</code></pre>

<p>If you have a unique way of retrieving a single object from your data store, you can get that object directly:</p>

<pre><code>Person *person = [Person findFirstByAttribute:@"FirstName" withValue:@"Forrest"];
</code></pre>

<h4>Advanced Finding</h4>

<p>If you want to be more specific with your search, you can send in a predicate:</p>

<pre><code>NSArray *departments = [NSArray arrayWithObjects:dept1, dept2, ..., nil];
NSPredicate *peopleFilter = [NSPredicate predicateWithFormat:@"Department IN %@", departments];

NSArray *people = [Person findAllWithPredicate:peopleFilter];
</code></pre>

<h4>Returning an NSFetchRequest</h4>

<pre><code>NSPredicate *peopleFilter = [NSPredicate predicateWithFormat:@"Department IN %@", departments];

NSArray *people = [Person fetchAllWithPredicate:peopleFilter];
</code></pre>

<p>For each of these single line calls, the full stack of NSFetchRequest, NSSortDescriptors and a simple default error handling scheme (ie. logging to the console) is created.</p>

<h4>Customizing the Request</h4>

<pre><code>NSPredicate *peopleFilter = [NSPredicate predicateWithFormat:@"Department IN %@", departments];

NSFetchRequest *peopleRequest = [Person requestAllWithPredicate:peopleFilter];
[peopleRequest setReturnsDistinctResults:NO];
[peopleRequest setReturnPropertiesNamed:[NSArray arrayWithObjects:@"FirstName", @"LastName", nil]];
...

NSArray *people = [Person executeFetchRequest:peopleRequest];
</code></pre>

<h4>Find the number of entities</h4>

<p>You can also perform a count of entities in your Store, that will be performed on the Store</p>

<pre><code>NSNumber *count = [Person numberOfEntities];
</code></pre>

<p>Or, if you&rsquo;re looking for a count of entities based on a predicate or some filter:</p>

<pre><code>NSNumber *count = [Person numberOfEntitiesWithPredicate:...];
</code></pre>

<p>There are also counterpart methods which return NSUInteger rather than NSNumbers:</p>

<ul>
<li>countOfEntities</li>
<li>countOfEntitiesWithContext:(NSManagedObjectContext *)</li>
<li>countOfEntitiesWithPredicate:(NSPredicate *)</li>
<li>countOfEntitiesWithPredicate:(NSPredicate <em>) inContext:(NSManagedObjectContext </em>)</li>
</ul>


<h4>Aggregate Operations</h4>

<pre><code>NSPredicate *prediate = [NSPredicate predicateWithFormat:@"diaryEntry.date == %@", today];
int totalFat = [[CTFoodDiaryEntry aggregateOperation:@"sum:" onAttribute:@"fatColories" withPredicate:predicate] intValue];
int fattest  = [[CTFoodDiaryEntry aggregateOperation:@"max:" onAttribute:@"fatColories" withPredicate:predicate] intValue];
</code></pre>

<h4>Finding from a different context</h4>

<p>All find, fetch and request methods have an inContext: method parameter</p>

<pre><code>NSManagedObjectContext *someOtherContext = ...;

NSArray *peopleFromAnotherContext = [Person findAllInContext:someOtherContext];

...

Person *personFromContext = [Person findFirstByAttribute:@"lastName" withValue:@"Gump" inContext:someOtherContext];

...

NSUInteger count = [Person numberOfEntitiesWithContext:someOtherContext];
</code></pre>

<h2>Creating new Entities</h2>

<p>When you need to create a new instance of an Entity, use:</p>

<pre><code>Person *myNewPersonInstance = [Person createEntity];
</code></pre>

<p>or, to specify a context:</p>

<pre><code>NSManagedObjectContext *otherContext = ...;

Person *myPerson = [Person createInContext:otherContext];
</code></pre>

<h2>Deleting Entities</h2>

<p>To delete a single entity:</p>

<pre><code>Person *p = ...;
[p  deleteEntity];
</code></pre>

<p>or, to specify a context:</p>

<pre><code>NSManagedObjectContext *otherContext = ...;
Person *deleteMe = ...;

[deleteMe deleteInContext:otherContext];
</code></pre>

<p>There is no delete <em>All Entities</em> or <em>truncate</em> operation in core data, so one is provided for you with Active Record for Core Data:</p>

<pre><code>[Person truncateAll];
</code></pre>

<p>or, with a specific context:</p>

<pre><code>NSManagedObjectContext *otherContext = ...;
[Person truncateAllInContext:otherContext];
</code></pre>

<h2>Performing Core Data operations on Threads</h2>

<p>Available only on iOS 4.0 and Mac OS 10.6</p>

<p>Paraphrasing the <a href="" title="[http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CoreData/Articles/cdConcurrency.html](http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CoreData/Articles/cdConcurrency.html)#//apple_ref/doc/uid/TP40003385-SW1">Apple documentation on Core Data and Threading</a>, you should always do the following:</p>

<ul>
<li>Use a new, dedicated NSManagedObjectContext instance for every thread</li>
<li>Use an instance of your NSManagedObjects that is local for the new NSManagedObjectContext</li>
<li>Notify other contexts that the background is updated or saved</li>
</ul>


<p>The Magical Record library is trying to make these steps more reusable with the following methods:</p>

<pre><code>+ (void) performSaveDataOperationWithBlock:(CoreDataBlock)block;
+ (void) performSaveDataOperationInBackgroundWithBlock:(CoreDataBlock)block;
</code></pre>

<p>CoreDataBlock is typedef&rsquo;d as:</p>

<pre><code>typedef void (^CoreDataBlock)(NSManagedObjectContext *);
</code></pre>

<p>All the boilerplate operations that need to be done when saving are done in these methods. To use this method from the <em>main thread</em>:</p>

<pre><code>Person *person = ...;
[MRCoreDataAction saveDataInBackgroundWithBlock:^(NSManagedObjectContext *localContext){
    Person *localPerson = [person inContext:localContext];

    localPerson.firstName = @"Chuck";
    localPerson.lastName = @"Smith";
}];
</code></pre>

<p>In this method, the CoreDataBlock provides you with the proper context in which to perform your operations, you don&rsquo;t need to worry about setting up the context so that it tells the Default Context that it&rsquo;s done, and should update because changes were performed on another thread.</p>

<p>To perform an action after this save block is completed, you can fill in a completion block:</p>

<pre><code>Person *person = ...;
[MRCoreDataAction saveDataInBackgroundWithBlock:^(NSManagedObjectContext *localContext){
    Person *localPerson = [person inContext:localContext];

    localPerson.firstName = @"Chuck";
    localPerson.lastName = @"Smith";
} completion:^{

    self.everyoneInTheDepartment = [Person findAll];
}];
</code></pre>

<p>This completion block is called on the main thread (queue), so this is also safe for triggering UI updates.</p>

<p>All MRCoreDataActions have a dedicated GCD queue on which they operate. This means that throughout your app, you only really have 2 queues (sort of like threads) performing Core Data actions at any one time: one on the main queue, and another on this dedicated GCD queue.</p>

<h1>Data Import</h1>

<p><em>Experimental</em></p>

<p>MagicalRecord will now import data from NSDictionaries into your Core Data store. <a href="https://github.com/magicalpanda/MagicalRecord/wiki/Data-Import">Documentation</a> for this feature will be added to the wiki.
This feature is currently under development, and is undergoing updates. Feel free to try it out, add tests and send in your feedback.</p>

<h1>Extra Bits</h1>

<p>This Code is released under the MIT License by <a href="http://www.magicalpanda.com">Magical Panda Software, LLC.</a></p>
						
						
					</div>
					
                        
                    
					
					
					<div class="index-column">
						<h2 class="index-title">Class References</h2>
						<ul>
							
							<li><a href="Classes/MRCoreDataAction.html">MRCoreDataAction</a></li>
							
							<li><a href="Classes/MagicalRecordHelpers.html">MagicalRecordHelpers</a></li>
							
						</ul>
					</div>
					
					
						
					<div class="index-column">
						
						
						<h2 class="index-title">Category References</h2>
						<ul>
							
							<li><a href="Categories/NSAttributeDescription+MagicalRecord_DataImport.html">NSAttributeDescription(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSEntityDescription+MagicalRecord_DataImport.html">NSEntityDescription(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSManagedObject+MagicalRecord.html">NSManagedObject(MagicalRecord)</a></li>
							
							<li><a href="Categories/NSManagedObject+MagicalRecordShortHand.html">NSManagedObject(MagicalRecordShortHand)</a></li>
							
							<li><a href="Categories/NSManagedObject+MagicalRecord_DataImport.html">NSManagedObject(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSManagedObject+MagicalRecord_DataImportShortHand.html">NSManagedObject(MagicalRecord_DataImportShortHand)</a></li>
							
							<li><a href="Categories/NSManagedObjectContext+MagicalRecord.html">NSManagedObjectContext(MagicalRecord)</a></li>
							
							<li><a href="Categories/NSManagedObjectContext+MagicalRecordShortHand.html">NSManagedObjectContext(MagicalRecordShortHand)</a></li>
							
							<li><a href="Categories/NSManagedObjectModel+MagicalRecord.html">NSManagedObjectModel(MagicalRecord)</a></li>
							
							<li><a href="Categories/NSManagedObjectModel+MagicalRecordShortHand.html">NSManagedObjectModel(MagicalRecordShortHand)</a></li>
							
							<li><a href="Categories/NSNumber+MagicalRecord_DataImport.html">NSNumber(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSObject+MagicalRecord_DataImport.html">NSObject(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSPersistentStore+MagicalRecord.html">NSPersistentStore(MagicalRecord)</a></li>
							
							<li><a href="Categories/NSPersistentStore+MagicalRecordShortHand.html">NSPersistentStore(MagicalRecordShortHand)</a></li>
							
							<li><a href="Categories/NSPersistentStoreCoordinator+MagicalRecord.html">NSPersistentStoreCoordinator(MagicalRecord)</a></li>
							
							<li><a href="Categories/NSPersistentStoreCoordinator+MagicalRecordShortHand.html">NSPersistentStoreCoordinator(MagicalRecordShortHand)</a></li>
							
							<li><a href="Categories/NSRelationshipDescription+MagicalRecord_DataImport.html">NSRelationshipDescription(MagicalRecord_DataImport)</a></li>
							
							<li><a href="Categories/NSString+MagicalRecord_DataImport.html">NSString(MagicalRecord_DataImport)</a></li>
							
						</ul>
						
					</div>
					
				</div>
				<div class="main-navigation navigation-bottom">
					<a href="hierarchy.html">Next</a>
				</div>
				<div id="footer">
					<hr />
					<div class="footer-copyright">
						<p><span class="copyright">&copy; 2012 Saul Mora. All rights reserved. (Last updated: 2012-06-06)</span><br />
						
						<span class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.0.5 (build 789)</a>.</span></p>
						
	
					</div>
				</div>
			</div>
		</article>		
	</body>
</html>